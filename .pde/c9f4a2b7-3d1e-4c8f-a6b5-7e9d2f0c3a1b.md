# Prompt Decomposition

## Directions

- ğŸŒ… **EAST** â€” VISION: What is being asked?
- ğŸ”¥ **SOUTH** â€” ANALYSIS: What needs to be learned?
- ğŸŒŠ **WEST** â€” VALIDATION: What needs reflection?
- â„ï¸ **NORTH** â€” ACTION: What executes the cycle?

## Original Prompt

> Add Architecture Overview section to README.md: main diagram like WillWrite, 1-2 sub-diagrams from STC state machine perspective, plus "Envisioned Next Major Architecture" section with Narintel Suite codename. Focus on what is actually implemented in ./storytelling/ (Python only, not JS parity).

## Primary Intent

**Action:** manifest
**Target:** README.md Architecture Overview â€” three-tier diagrammatic portrait of storytelling: implemented pipeline, STC state transitions, and envisioned NARINTEL next phase
* You could also see where discretly you could add that to the global docs in @llms/docs but really discreet and given that it can link to the README.md (which is what will be seen at `https://storytelling.jgwill.com` you can add links or create a simpler form of diagrams...

**Urgency:** session
**Confidence:** 96%

## Secondary Intents

1. **create** â€” Main architecture block diagram (Mermaid) mapping LangGraph pipeline nodes in `graph.py` _(explicit)_
* The guidances llms/imported/llms-langchain.txt along with LangGraph is what motivated this new version to leverage the power of the graph and chains....

2. **create** â€” STC State Machine sub-diagram: story generation pipeline mapped to structural tension state transitions _(explicit)_
   - depends on: main diagram
* Relates on previous llms/imported/llms-langchain.txt that in a sense with LangGraph are State Machine for LLMs...

3. **create** â€” NarrativeAware Story Graph sub-diagram: the NCP-aware enrichment loop (NarIntel modules) _(implicit)_
   - depends on: main diagram
4. **create** â€” Envisioned Next Major Architecture section with codename "WÃ¢pano" (NARINTEL:EAST) _(explicit)_
   - depends on: main diagram
5. **update** â€” README.md with all three diagram sections inserted after existing "Key Features" section _(explicit)_
   - depends on: all diagrams
6. **choose** â€” codename for next major version within Narintel Suite / medicine-wheel directions _(explicit)_
   - Resolution: **"WÃ¢pano"** â€” East direction in Cree (wÃ¢pan = dawn), medicine wheel East = Inquiry/new beginnings, maps to the first full Four-Directions multi-agent implementation

## Context Requirements

### Files Needed
- storytelling/graph.py â€” source of truth for pipeline nodes and edges (create_graph function)
- storytelling/narrative_story_graph.py â€” NarrativeAwareStoryGraph (NCP-aware enrichment loop)
- storytelling/narrative_intelligence_integration.py â€” NCPAwareStoryGenerator
- storytelling/emotional_beat_enricher.py â€” enrichment stage
- storytelling/analytical_feedback_loop.py â€” gap analysis stage
- storytelling/character_arc_tracker.py â€” persistent character state
- llms/llms-stc-state-machine.md â€” STC â†’ state machine mapping reference
- NARINTEL_README.md â€” architecture overview and Four Directions info
- llms/docs/medicine-wheel-research.md â€” Four Directions multi-agent reference
- README.md â€” current README to update
- llms/imported/llms-langchain.txt
- llms/imported/llms-langfuse.txt --> Planning to trace, add that into ./rispecs where it should be simply.... and the diagrams could contains a node tracing (planned) 

### Tools Required
- file editor
- git
- mermaid-compatible renderer (diagrams are embedded as fenced code blocks)

### Assumptions
- Diagrams will be Mermaid flowchart/stateDiagram format embedded in README.md fenced blocks
- WillWrite uses an SVG file; we'll use inline Mermaid (GitHub renders it natively)
- The "JS parity" effort (js/) is explicitly excluded from the current architecture diagrams
- The NarrativeAware story graph (NARINTEL modules) exists as Python code but the FULL Four-Directions system is not yet wired into the main graph.py workflow â€” it belongs in the "envisioned" section
- Session checkpoint/resume capability should be visible in the main diagram
- RAG/knowledge base is part of current implementation and should appear
* There is also the 'glossary in YAML' that is new and should be there, really important for the Ontology discussed probably in @llms/docs

- Codename "WÃ¢pano" (East/Dawn/Inquiry) fits because: medicine wheel East = beginning/inquiry, Four Directions East agent = bias detection + structural tension detection, and this next version BEGINS the full medicine-wheel multi-agent journey

## Four Directions Analysis

### ğŸŒ… EAST â€” VISION

- Envision README as a living architectural portrait: shows where we are (implemented pipeline), how it moves (STC state machine), and where we're going (WÃ¢pano/NARINTEL:EAST) [96%]
- The diagrams make the structural tension VISIBLE: current reality (existing pipeline) vs. desired outcome (full Four-Directions NARINTEL suite) [90%] _(implicit)_

### ğŸ”¥ SOUTH â€” ANALYSIS

- Map graph.py nodes/edges precisely: extract_base_context â†’ generate_story_elements â†’ generate_initial_outline â†’ determine_chapter_count â†’ generate_single_chapter_scene_by_scene â†’ revise_buzz_terms â†’ critique_chapter â†’ check_chapter_complete â†’ [revise | increment] â†’ generate_final_story [98%]
- Identify conditional edges (revision loops): should_revise_chapter (revise | increment), check_if_more_chapters_needed (generate_chapter | finalize) [95%]
- Map llms-stc-state-machine.md concepts to the pipeline states: tension_established â†’ action_step_completed â†’ moment_of_truth â†’ phase_advance â†’ tension_resolve [92%]
- Identify NARINTEL modules implemented in Python (NCP, enrichment, character tracking) vs. not yet wired into main pipeline [88%] _(implicit)_

### ğŸŒŠ WEST â€” VALIDATION

- Validate main diagram accurately reflects graph.py â€” every add_node and add_conditional_edges accounted for [98%]
- Validate STC sub-diagram captures the oscillation pattern (revision loop) and the advancement pattern (chapter progression) [92%]
- Validate "WÃ¢pano" codename is culturally grounded (Cree East direction) and not decorative [90%]
- Validate the envisioned section is clearly marked as "not yet implemented" to avoid confusion [95%]

### â„ï¸ NORTH â€” ACTION

- Write main LangGraph pipeline diagram (Mermaid flowchart) [97%]
- Write STC state machine sub-diagram (Mermaid stateDiagram-v2) [90%]
- Write NarIntel enrichment loop sub-diagram [85%]
- Write Envisioned WÃ¢pano architecture section with Four Directions multi-agent diagram [88%]
- Insert all sections into README.md after "Key Features" section [96%]
- Commit with meaningful message [98%]

## Action Stack

- [ ] Verify graph.py nodes/edges against create_graph() function (lines 1192-1259)
- [ ] Write main Mermaid flowchart â€” full LangGraph pipeline with session/RAG branches
- [ ] Write STC state machine diagram â€” pipeline stages as creative phases (Germination/Assimilation/Completion)
- [ ] Write NarIntel enrichment loop diagram â€” Generateâ†’Analyzeâ†’Enrichâ†’Track cycle
- [ ] Write Envisioned WÃ¢pano section â€” Four Directions multi-agent architecture
- [ ] Insert Architecture Overview sections into README.md (after line 76 "Key Features" section)
- [ ] Ensure all Mermaid blocks use correct syntax (GitHub renders flowchart/stateDiagram-v2)
- [ ] git add README.md
- [ ] Commit

## Ambiguity Flags

- **"How many sub-diagrams? User says '1-2'"**
  - Resolution: 2 sub-diagrams â€” (1) STC state machine overlay on the pipeline; (2) NarrativeAware enrichment loop (NARINTEL modules). Total 3 diagrams (main + 2 sub)
* There is where we are now and where we are going with this Major refactoring and Decolonization (the best way to see this is still Colonized by Western Culture's view on Storytelling, the process of decolonizing is in progress, you try to represent that in the diagram of the next major version...
- **"Where exactly to insert in README.md?"**
  - Resolution: After the "Key Features" section (line 76) and before "Command Line" section, or as a new "## Architecture" section before "## Documentation"
- **"How much detail in the Envisioned section â€” should it show specific module names or just shapes?"**
  - Resolution: Show the Four Directions structure clearly with agents + relationships, mark as "ğŸš§ Envisioned"
- **"Should the diagrams reference specific file names?"**
  - Resolution: Yes, add small notes/captions referencing the key source files for navigability

## Expected Outputs

### Artifacts
- README.md (updated with Architecture section)

### Updates
- README.md â€” new section "## ğŸ—ï¸ Architecture Overview" with 3 Mermaid diagrams
- README.md â€” new section "## ğŸŒ… Envisioned: WÃ¢pano (NARINTEL:EAST)" with vision diagram

### Communications
- Git commit: "[docs] Add Architecture Overview diagrams to README â€” pipeline, STC state machine, and WÃ¢pano vision"
