# WillWrite Data Schemas

This document defines the structure of the key data objects, particularly the JSON payloads, that are used throughout the WillWrite application.

## Session Management Schemas âœ… IMPLEMENTED

### SessionCheckpoint
**Purpose:** Preserve complete story generation state at natural progression boundaries  
**Generated By:** `SessionManager.save_checkpoint()`  
**Implementation:** `src/storytelling/session_manager.py`

**Schema:**
```python
@dataclass
class SessionCheckpoint:
    checkpoint_id: str          # Unique identifier for this creative moment
    node_name: str             # Workflow stage (story_elements, outline, chapter_N)
    timestamp: str             # When this creative state was preserved
    state: Dict[str, Any]      # Complete creative state for restoration
    metadata: Dict[str, Any]   # Additional context for creative consciousness
```

### SessionInfo  
**Purpose:** Complete session information for creative portfolio management  
**Generated By:** `SessionManager.create_session()`  
**Implementation:** `src/storytelling/session_manager.py`

**Schema:**
```python
@dataclass
class SessionInfo:
    session_id: str                    # Unique creative workspace identifier
    created_at: str                    # When creative work began
    last_checkpoint: str               # Most recent creative progress point
    status: str                        # Creative session state
    prompt_file: str                   # Original creative vision
    output_file: str                   # Target creative manifestation
    checkpoints: List[SessionCheckpoint] # Complete creative progression history
    configuration: Dict[str, Any]       # Technical creative environment
```

**Status Values:**
- `in_progress`: Creative work actively advancing
- `completed`: Creative vision fully manifested  
- `interrupted`: Creative work paused, ready for resume
- `failed`: Technical issue requiring attention

## 1. Chapter Count

**Purpose:** Used to determine the number of chapters in the story.
**Generated By:** `ChapterDetector.LLMCountChapters`
**Prompt:** `CHAPTER_COUNT_PROMPT`

**Schema:**
```json
{
  "TotalChapters": "number"
}
```

**Example:**
```json
{
  "TotalChapters": 10
}
```

## 2. Outline and Chapter Completion

**Purpose:** Used in the refinement loops to determine if the outline or a chapter meets the required quality standards.
**Generated By:** `LLMEditor.GetOutlineRating`, `LLMEditor.GetChapterRating`
**Prompts:** `OUTLINE_COMPLETE_PROMPT`, `CHAPTER_COMPLETE_PROMPT`

**Schema:**
```json
{
  "IsComplete": "boolean"
}
```

**Example:**
```json
{
  "IsComplete": true
}
```

## 3. Chapter Summary Check

**Purpose:** Used to verify that a generated chapter follows the outline.
**Generated By:** `ChapterGenSummaryCheck.LLMSummaryCheck`
**Prompt:** `SUMMARY_COMPARE_PROMPT`

**Schema:**
```json
{
  "DidFollowOutline": "boolean",
  "Suggestions": "string"
}
```

**Example:**
```json
{
  "DidFollowOutline": true,
  "Suggestions": "Important things to keep in mind as you write: 
- Ensure the protagonist's motivation remains clear.
- The pacing in the second half could be slightly faster."
}
```

## 4. Story Info / Metadata

**Purpose:** Contains the final metadata for the generated story.
**Generated By:** `StoryInfo.GetStoryInfo`
**Prompt:** `STATS_PROMPT`

**Schema:**
```json
{
  "Title": "string",
  "Summary": "string",
  "Tags": "string",
  "OverallRating": "number"
}
```

**Example:**
```json
{
  "Title": "The Last Echo",
  "Summary": "In a world where silence is a commodity, a young woman discovers a device that can replay lost sounds, forcing her to confront a past that the world has chosen to forget.",
  "Tags": "sci-fi, dystopia, mystery, sound",
  "OverallRating": 88
}
```

## 5. Scene List (from Scene-by-Scene Generation)

**Purpose:** A temporary data structure used in the scene-by-scene chapter generation pipeline.
**Generated By:** `ScenesToJSON.ScenesToJSON`
**Prompt:** `SCENES_TO_JSON`

**Schema:**
A JSON array of strings, where each string is the detailed outline for a single scene.

**Example:**
```json
[
    "Scene 1: The protagonist, Anya, discovers the sound device in her grandfather's attic. The mood is dusty and nostalgic. Key event: The device accidentally activates, playing a snippet of a forgotten song.",
    "Scene 2: Anya experiments with the device, replaying sounds from her childhood. The tone is one of wonder and discovery. Conflict: She realizes the device is picking up sounds that are not from her own past.",
    "Scene 3: Anya is confronted by a mysterious stranger who seems to know about the device. The tone is tense and suspicious. Resolution: The stranger warns her to stop using the device, leading into the next chapter."
]
```
